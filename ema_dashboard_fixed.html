<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMA Risk Assessment System | Perspective</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .pattern-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid;
            position: relative;
        }
        
        .bullish { 
            border-color: #00ff88; 
            background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,255,136,0.05)); 
        }
        
        .bearish { 
            border-color: #ff4444; 
            background: linear-gradient(135deg, rgba(255,68,68,0.1), rgba(255,68,68,0.05)); 
        }
        
        .neutral { 
            border-color: #ffaa00; 
            background: linear-gradient(135deg, rgba(255,170,0,0.1), rgba(255,170,0,0.05)); 
        }
        
        .dangerous { 
            border-color: #ff0066; 
            background: linear-gradient(135deg, rgba(255,0,102,0.1), rgba(255,0,102,0.05)); 
        }
        
        .visual-pattern {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .timeframe-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border-left: 5px solid #00d4ff;
        }
        
        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .correlation-table th,
        .correlation-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9em;
        }
        
        .correlation-table th {
            background: rgba(0,212,255,0.2);
            font-weight: bold;
        }
        
        .system-box {
            background: linear-gradient(135deg, #1a4a2d, #0d2318);
            border: 3px solid #00ff88;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .warning-box {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,140,0,0.1));
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .rule {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00d4ff;
        }
        
        .signal-strength {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .strength-bar {
            width: 100px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .strength-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .strong { background: #00ff88; width: 90%; }
        .medium { background: #ffaa00; width: 60%; }
        .weak { background: #ff4444; width: 30%; }
        
        .chart-visual {
            background: linear-gradient(135deg, #000000, #1a1a1a);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            color: #ccc;
            font-family: 'Courier New', monospace;
        }
        
        .ema-line {
            padding: 3px;
            margin: 2px 0;
            border-radius: 3px;
        }
        
        .ema-9 { background: #00ff88; color: #000; }
        .ema-50 { background: #ffaa00; color: #000; }
        .ema-200 { background: #ff4444; color: #fff; }
        
        .probability {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }
        
        .high-prob { color: #00ff88; }
        .med-prob { color: #ffaa00; }
        .low-prob { color: #ff4444; }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-group select,
        .input-group input {
            width: 100%;
            background: #333;
            color: white;
            padding: 8px;
            border: 1px solid #666;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .result-box {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .result-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.05);
        }
        
        .btn {
            background: #00ff88;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #00cc6a;
        }
        
        .btn-secondary {
            background: #666;
            color: #fff;
        }
        
        .btn-danger {
            background: #ff6b35;
            color: #fff;
        }
        
        .error-message {
            background: rgba(255,68,68,0.1);
            border: 2px solid #ff4444;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .error-list {
            margin: 10px 0;
            padding-left: 20px;
            color: #ff4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ EMA Risk Assessment System</h1>
        
        <!-- Quick Recognition -->
        <section class="timeframe-section" role="region" aria-labelledby="recognition-heading">
            <h2 id="recognition-heading">üìä Quick Recognition Guide</h2>
            
            <div class="pattern-grid">
                <div class="pattern-card bullish">
                    <h3>‚úÖ HIGH PROBABILITY SETUP</h3>
                    <div class="chart-visual">
                        <div class="ema-line ema-9">9 EMA (fastest)</div>
                        <div class="ema-line ema-50">50 EMA (medium)</div>
                        <div class="ema-line ema-200">200 EMA (slowest)</div>
                    </div>
                    <p><strong>Pattern:</strong> EMAs stacked like stairs with clear gaps</p>
                    <p><strong>Entry:</strong> Price bounces cleanly off 9 EMA</p>
                    <p><strong>Volume:</strong> Above average on the bounce</p>
                </div>
                
                <div class="pattern-card dangerous">
                    <h3>‚ùå LOW PROBABILITY SETUP</h3>
                    <div class="chart-visual">
                        <div class="ema-line ema-200">200 EMA</div>
                        <div class="ema-line ema-50">50 EMA</div>
                        <div class="ema-line ema-9">9 EMA</div>
                    </div>
                    <p><strong>Avoid:</strong> EMAs tangled or crossing frequently</p>
                    <p><strong>Wait:</strong> For clear separation to develop</p>
                    <p><strong>Risk:</strong> High false signal probability</p>
                </div>
            </div>
        </section>
        
        <!-- EMA Separation Analysis -->
        <div class="timeframe-section">
            <h2>üìè EMA Relationship Success Rates</h2>
            
            <table class="correlation-table">
                <thead>
                    <tr>
                        <th>EMA Configuration</th>
                        <th>Market Condition</th>
                        <th>Success Rate</th>
                        <th>Recommended Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>9 > 50 > 200 (Wide gaps)</strong></td>
                        <td class="high-prob">Strong Uptrend</td>
                        <td class="high-prob">75-85%</td>
                        <td>Execute trades on 9 EMA bounces</td>
                    </tr>
                    <tr>
                        <td><strong>9 > 50 > 200 (Narrow gaps)</strong></td>
                        <td class="med-prob">Weak Uptrend</td>
                        <td class="med-prob">45-60%</td>
                        <td>Reduce position size, wait for better setup</td>
                    </tr>
                    <tr>
                        <td><strong>EMAs crossing/tangled</strong></td>
                        <td class="low-prob">Sideways/Indecision</td>
                        <td class="low-prob">25-40%</td>
                        <td>Stay out - high probability of whipsaws</td>
                    </tr>
                    <tr>
                        <td><strong>200 > 50 > 9 (Wide gaps)</strong></td>
                        <td class="low-prob">Strong Downtrend</td>
                        <td class="med-prob">70-80%</td>
                        <td>Short rallies to 9 EMA (if shorting)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Professional Risk Calculator -->
        <div class="system-box">
            <h2>üí∞ Professional Risk Assessment Calculator</h2>
            <p>Calculate your statistical edge and position sizing in real-time:</p>
            
            <div class="calculator-grid">
                <!-- Input Column -->
                <div>
                    <h3>üìä Market Assessment</h3>
                    
                    <div class="input-group">
                        <label for="trendDirection">Trend Direction:</label>
                        <select id="trendDirection" aria-label="Select trend direction">
                            <option value="0">Against trend (-10pts)</option>
                            <option value="15">Sideways (15pts)</option>
                            <option value="35">With trend (35pts)</option>
                            <option value="50">Strong trend (50pts)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="emaAlignment">EMA Alignment:</label>
                        <select id="emaAlignment" aria-label="Select EMA alignment quality">
                            <option value="0">Crossed/Tangled (0pts)</option>
                            <option value="15">Slight separation (15pts)</option>
                            <option value="30">Good separation (30pts)</option>
                            <option value="40">Perfect stairs (40pts)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="entryQuality">Entry Signal Quality:</label>
                        <select id="entryQuality" aria-label="Select entry signal quality">
                            <option value="0">Poor signal (0pts)</option>
                            <option value="8">Weak bounce (8pts)</option>
                            <option value="15">Clean bounce (15pts)</option>
                            <option value="25">Perfect setup (25pts)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="volumeLevel">Volume Level:</label>
                        <select id="volumeLevel" aria-label="Select volume level">
                            <option value="0">Below average (0pts)</option>
                            <option value="5">Average (5pts)</option>
                            <option value="10">Above average (10pts)</option>
                            <option value="15">High volume (15pts)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="rewardRisk">Reward:Risk Ratio:</label>
                        <select id="rewardRisk" aria-label="Select reward to risk ratio">
                            <option value="2">2:1 (Conservative)</option>
                            <option value="3" selected>3:1 (Standard)</option>
                            <option value="4">4:1 (Aggressive)</option>
                            <option value="5">5:1 (Very Aggressive)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="accountSize">Account Size ($):</label>
                        <input type="number" id="accountSize" placeholder="25000" min="1000" max="10000000" aria-label="Enter account size in dollars">
                    </div>
                    
                    <div class="input-group">
                        <label for="riskPercent">Risk % per trade:</label>
                        <input type="number" id="riskPercent" placeholder="2" step="0.1" min="0.1" max="10" aria-label="Enter risk percentage per trade">
                    </div>
                </div>
                
                <!-- Results Column -->
                <div>
                    <h3>üéØ Risk Metrics</h3>
                    
                    <div class="result-box">
                        <div class="result-item">
                            <strong>Total Assessment Score:</strong>
                            <div style="font-size: 1.5em; font-weight: bold; margin: 5px 0;" id="totalScore">0/130</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Success Probability:</strong>
                            <div style="font-size: 1.8em; font-weight: bold; margin: 5px 0;" id="successRate">--</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Risk Amount:</strong>
                            <div style="font-size: 1.3em; color: #ff6b35;" id="riskAmount">$--</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Expected Profit:</strong>
                            <div style="font-size: 1.3em; color: #00ff88;" id="expectedProfit">$--</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Expected Value per Trade:</strong>
                            <div style="font-size: 1.3em; color: #00d4ff;" id="expectedValue">$--</div>
                        </div>
                        
                        <div style="margin: 15px 0; padding: 15px; border-radius: 8px; border: 2px solid transparent;" id="tradeDecision">
                            Enter assessment parameters above
                        </div>
                    </div>
                </div>
                
                <!-- Projections Column -->
                <div>
                    <h3>üìà Performance Projections</h3>
                    
                    <div class="result-box">
                        <div class="input-group">
                            <label for="tradesPerMonth">Trades per month:</label>
                            <input type="number" id="tradesPerMonth" placeholder="8" min="1" max="50" aria-label="Enter expected trades per month">
                        </div>
                        
                        <div class="result-item">
                            <strong>Monthly Expected Profit:</strong>
                            <div style="font-size: 1.4em; color: #00ff88;" id="monthlyProfit">$--</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Monthly Return %:</strong>
                            <div style="font-size: 1.4em; color: #ffd700;" id="monthlyReturn">--%</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Annual Projection:</strong>
                            <div style="font-size: 1.2em; color: #00d4ff;" id="annualProjection">--%</div>
                        </div>
                        
                        <div class="result-item">
                            <strong>Risk of Ruin (10 losses):</strong>
                            <div style="font-size: 1.1em; color: #ffaa00;" id="riskOfRuin">--%</div>
                        </div>
                        
                        <div style="margin: 15px 0; font-size: 0.9em; color: #ccc;">
                            <strong>Note:</strong> Projections assume consistent execution and market conditions
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                <button id="conservativeBtn" class="btn">Conservative Setup</button>
                <button id="aggressiveBtn" class="btn btn-danger">Aggressive Setup</button>
                <button id="resetBtn" class="btn btn-secondary">Reset Calculator</button>
            </div>
            
            <!-- Error Messages -->
            <div id="validationMessages" class="error-message">
                <h4 style="color: #ff4444;">‚ö†Ô∏è Input Validation Errors:</h4>
                <ul id="errorList" class="error-list"></ul>
            </div>
        </div>
        
        <!-- Quick Reference -->
        <div class="timeframe-section">
            <h2>‚ö° Quick Decision Framework</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                <div class="pattern-card bullish">
                    <h3>‚úÖ EXECUTE TRADE</h3>
                    <div class="probability high-prob">70%+ Success Rate</div>
                    <p><strong>Criteria:</strong></p>
                    <p>‚Ä¢ EMAs properly aligned (30+ points)</p>
                    <p>‚Ä¢ Clean entry signal (15+ points)</p>
                    <p>‚Ä¢ Strong trend direction (35+ points)</p>
                    <p>‚Ä¢ Volume confirmation (10+ points)</p>
                    <p><strong>Total Score: 90+ points</strong></p>
                </div>
                
                <div class="pattern-card neutral">
                    <h3>‚ö†Ô∏è PROCEED WITH CAUTION</h3>
                    <div class="probability med-prob">50-69% Success Rate</div>
                    <p><strong>Criteria:</strong></p>
                    <p>‚Ä¢ Moderate alignment (15-29 points)</p>
                    <p>‚Ä¢ Average signals (8-14 points)</p>
                    <p>‚Ä¢ Weak trend (15-34 points)</p>
                    <p>‚Ä¢ Normal volume (5-9 points)</p>
                    <p><strong>Total Score: 50-89 points</strong></p>
                </div>
                
                <div class="pattern-card dangerous">
                    <h3>‚ùå AVOID TRADE</h3>
                    <div class="probability low-prob">&lt;50% Success Rate</div>
                    <p><strong>Criteria:</strong></p>
                    <p>‚Ä¢ Poor EMA alignment (0-14 points)</p>
                    <p>‚Ä¢ Weak entry signals (0-7 points)</p>
                    <p>‚Ä¢ Against trend (0-14 points)</p>
                    <p>‚Ä¢ Low volume (0-4 points)</p>
                    <p><strong>Total Score: &lt;50 points</strong></p>
                </div>
            </div>
        </div>
        
        <!-- System Summary -->
        <div class="system-box">
            <h2>üéØ Assessment System Summary</h2>
            
            <div class="rule">
                <h3>üìã Pre-Trade Checklist:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                    <div>
                        <h4>‚úÖ Assessment Steps:</h4>
                        <p>1. Evaluate EMA alignment and separation</p>
                        <p>2. Assess trend direction strength</p>
                        <p>3. Confirm entry signal quality</p>
                        <p>4. Check volume confirmation</p>
                        <p>5. Calculate risk and position size</p>
                        <p>6. Review success probability</p>
                    </div>
                    <div>
                        <h4>üõë Risk Management Rules:</h4>
                        <p>‚Ä¢ Never risk more than 2-3% per trade</p>
                        <p>‚Ä¢ Require 60%+ success probability</p>
                        <p>‚Ä¢ Use stop losses at key EMA levels</p>
                        <p>‚Ä¢ Target minimum 3:1 reward:risk ratio</p>
                        <p>‚Ä¢ Track all assessments for review</p>
                        <p>‚Ä¢ Avoid trading during low probability periods</p>
                    </div>
                </div>
            </div>
            
            <div style="background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center;">
                <h3 style="color: #ffd700;">üèÜ Success Formula</h3>
                <p style="font-size: 1.2em; margin: 10px 0;">
                    <strong>Systematic Assessment + Risk Management + Consistent Execution = Long-term Success</strong>
                </p>
                <p style="color: #ccc;">
                    This system provides statistical edge through evidence-based decision making. Your success depends on disciplined execution of the assessment framework.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Professional Trading Calculator with Error Handling
        class TradingRiskCalculator {
            constructor() {
                this.elements = {};
                this.isInitialized = false;
                this.debounceTimer = null;
                this.init();
            }
            
            init() {
                try {
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', () => this.setup());
                    } else {
                        this.setup();
                    }
                } catch (error) {
                    console.error('Calculator initialization failed:', error);
                    this.showError('System initialization failed. Please refresh the page.');
                }
            }
            
            setup() {
                try {
                    this.cacheElements();
                    this.bindEvents();
                    this.isInitialized = true;
                    this.calculate(); // Initial calculation
                } catch (error) {
                    console.error('Calculator setup failed:', error);
                    this.showError('Calculator setup failed. Please check your inputs and try again.');
                }
            }
            
            cacheElements() {
                const elementIds = [
                    'trendDirection', 'emaAlignment', 'entryQuality', 'volumeLevel', 
                    'rewardRisk', 'accountSize', 'riskPercent', 'tradesPerMonth',
                    'totalScore', 'successRate', 'riskAmount', 'expectedProfit', 
                    'expectedValue', 'tradeDecision', 'monthlyProfit', 'monthlyReturn', 
                    'annualProjection', 'riskOfRuin', 'conservativeBtn', 'aggressiveBtn', 
                    'resetBtn', 'validationMessages', 'errorList'
                ];
                
                elementIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        this.elements[id] = element;
                    }
                });
            }
            
            bindEvents() {
                const inputElements = ['trendDirection', 'emaAlignment', 'entryQuality', 
                                     'volumeLevel', 'rewardRisk', 'accountSize', 'riskPercent', 'tradesPerMonth'];
                
                inputElements.forEach(id => {
                    const element = this.elements[id];
                    if (element) {
                        element.addEventListener('change', () => this.debouncedCalculate());
                        element.addEventListener('input', () => this.debouncedCalculate());
                    }
                });
                
                // Button events
                this.safeAddEventListener('conservativeBtn', 'click', () => this.setConservative());
                this.safeAddEventListener('aggressiveBtn', 'click', () => this.setAggressive());
                this.safeAddEventListener('resetBtn', 'click', () => this.reset());
            }
            
            safeAddEventListener(elementId, event, handler) {
                const element = this.elements[elementId];
                if (element) {
                    element.addEventListener(event, (e) => {
                        try {
                            handler(e);
                        } catch (error) {
                            console.error(`Error in ${elementId} ${event} handler:`, error);
                            this.showError(`Action failed. Please try again.`);
                        }
                    });
                }
            }
            
            debouncedCalculate() {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    try {
                        this.calculate();
                    } catch (error) {
                        console.error('Calculation error:', error);
                        this.showError('Calculation failed. Please check your inputs.');
                    }
                }, 150);
            }
            
            validateInputs() {
                const errors = [];
                const accountSize = this.getNumericValue('accountSize', 25000);
                const riskPercent = this.getNumericValue('riskPercent', 2);
                const tradesPerMonth = this.getNumericValue('tradesPerMonth', 8);
                
                if (accountSize < 1000) errors.push('Account size must be at least $1,000');
                if (accountSize > 10000000) errors.push('Account size seems unrealistic (>$10M)');
                if (riskPercent < 0.1) errors.push('Risk percentage must be at least 0.1%');
                if (riskPercent > 10) errors.push('Risk percentage above 10% is extremely dangerous');
                if (tradesPerMonth < 1) errors.push('Must plan for at least 1 trade per month');
                if (tradesPerMonth > 50) errors.push('More than 50 trades/month may indicate overtrading');
                
                this.displayValidationErrors(errors);
                return errors.length === 0;
            }
            
            displayValidationErrors(errors) {
                const messagesDiv = this.elements.validationMessages;
                const errorList = this.elements.errorList;
                
                if (!messagesDiv || !errorList) return;
                
                if (errors.length === 0) {
                    messagesDiv.style.display = 'none';
                    return;
                }
                
                errorList.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
                messagesDiv.style.display = 'block';
            }
            
            showError(message) {
                if (this.elements.validationMessages && this.elements.errorList) {
                    this.elements.errorList.innerHTML = `<li>${message}</li>`;
                    this.elements.validationMessages.style.display = 'block';
                }
            }
            
            getNumericValue(elementId, defaultValue) {
                const element = this.elements[elementId];
                if (!element) return defaultValue;
                
                const value = parseFloat(element.value);
                return isNaN(value) ? defaultValue : value;
            }
            
            getSelectValue(elementId, defaultValue) {
                const element = this.elements[elementId];
                if (!element) return defaultValue;
                
                const value = parseInt(element.value);
                return isNaN(value) ? defaultValue : value;
            }
            
            calculate() {
                if (!this.isInitialized) return;
                
                // Validate inputs first
                if (!this.validateInputs()) return;
                
                // Get input values
                const trend = this.getSelectValue('trendDirection', 0);
                const alignment = this.getSelectValue('emaAlignment', 0);
                const entry = this.getSelectValue('entryQuality', 0);
                const volume = this.getSelectValue('volumeLevel', 0);
                const rewardRisk = this.getNumericValue('rewardRisk', 3);
                const accountSize = this.getNumericValue('accountSize', 25000);
                const riskPercent = this.getNumericValue('riskPercent', 2);
                const tradesPerMonth = this.getNumericValue('tradesPerMonth', 8);
                
                // Calculate total score
                const totalScore = trend + alignment + entry + volume;
                const maxScore = 130;
                
                // Enhanced probability calculation with realistic scaling
                let successRate;
                const scorePercentage = totalScore / maxScore;
                
                if (scorePercentage >= 0.85) {
                    successRate = Math.min(88, 78 + (scorePercentage - 0.85) * 67);
                } else if (scorePercentage >= 0.65) {
                    successRate = 60 + (scorePercentage - 0.65) * 90;
                } else if (scorePercentage >= 0.4) {
                    successRate = 35 + (scorePercentage - 0.4) * 100;
                } else {
                    successRate = Math.max(20, 20 + scorePercentage * 37.5);
                }
                
                successRate = Math.round(successRate);
                
                // Financial calculations
                const riskAmount = accountSize * (riskPercent / 100);
                const expectedProfit = riskAmount * rewardRisk;
                const winRate = successRate / 100;
                const lossRate = 1 - winRate;
                const expectedValue = (winRate * expectedProfit) - (lossRate * riskAmount);
                
                // Monthly projections
                const monthlyExpectedProfit = expectedValue * tradesPerMonth;
                const monthlyReturn = (monthlyExpectedProfit / accountSize) * 100;
                const annualReturn = monthlyReturn * 12;
                
                // Risk of ruin calculation (probability of losing 10 trades in a row)
                const riskOfRuin = Math.pow(lossRate, 10) * 100;
                
                // Update displays
                this.updateDisplay({
                    totalScore: `${totalScore}/${maxScore}`,
                    successRate: `${successRate}%`,
                    riskAmount: `${riskAmount.toFixed(0)}`,
                    expectedProfit: `${expectedProfit.toFixed(0)}`,
                    expectedValue: `${expectedValue.toFixed(0)}`,
                    monthlyProfit: `${monthlyExpectedProfit.toFixed(0)}`,
                    monthlyReturn: `${monthlyReturn.toFixed(1)}%`,
                    annualProjection: `${annualReturn.toFixed(1)}% annually`,
                    riskOfRuin: `${riskOfRuin.toFixed(2)}%`
                });
                
                // Update trade decision
                this.updateTradeDecision(successRate, expectedValue, scorePercentage);
                
                // Color code returns
                this.colorCodeReturns(monthlyReturn, expectedValue);
            }
            
            updateDisplay(values) {
                Object.keys(values).forEach(key => {
                    if (this.elements[key]) {
                        this.elements[key].textContent = values[key];
                    }
                });
            }
            
            updateTradeDecision(successRate, expectedValue, scorePercentage) {
                const decisionElement = this.elements.tradeDecision;
                if (!decisionElement) return;
                
                let message, borderColor, backgroundColor;
                
                if (expectedValue <= 0) {
                    message = '‚ùå NEGATIVE EXPECTED VALUE - Avoid this trade setup';
                    borderColor = '#ff4444';
                    backgroundColor = 'rgba(255,68,68,0.1)';
                } else if (successRate >= 75 && scorePercentage >= 0.8) {
                    message = 'üöÄ EXCELLENT SETUP - High probability with strong edge';
                    borderColor = '#00ff88';
                    backgroundColor = 'rgba(0,255,136,0.1)';
                } else if (successRate >= 65 && expectedValue > 0) {
                    message = '‚úÖ GOOD SETUP - Solid probability with positive expected value';
                    borderColor = '#00d4ff';
                    backgroundColor = 'rgba(0,212,255,0.1)';
                } else if (successRate >= 50 && expectedValue > 0) {
                    message = '‚ö†Ô∏è MARGINAL SETUP - Proceed with caution and reduced size';
                    borderColor = '#ffaa00';
                    backgroundColor = 'rgba(255,170,0,0.1)';
                } else {
                    message = 'üî∏ POOR SETUP - Wait for better opportunity';
                    borderColor = '#ff6b35';
                    backgroundColor = 'rgba(255,107,53,0.1)';
                }
                
                decisionElement.textContent = message;
                decisionElement.style.borderColor = borderColor;
                decisionElement.style.background = backgroundColor;
            }
            
            colorCodeReturns(monthlyReturn, expectedValue) {
                const elements = [this.elements.monthlyReturn, this.elements.annualProjection];
                const valueElement = this.elements.expectedValue;
                
                let color;
                if (expectedValue > 0 && monthlyReturn > 8) {
                    color = '#00ff88'; // Excellent
                } else if (expectedValue > 0 && monthlyReturn > 3) {
                    color = '#00d4ff'; // Good
                } else if (expectedValue > 0) {
                    color = '#ffaa00'; // Marginal
                } else {
                    color = '#ff4444'; // Poor/Negative
                }
                
                elements.forEach(element => {
                    if (element) element.style.color = color;
                });
                
                if (valueElement) {
                    valueElement.style.color = expectedValue > 0 ? '#00ff88' : '#ff4444';
                }
            }
            
            setConservative() {
                this.setValues({
                    trendDirection: '35',
                    emaAlignment: '30', 
                    entryQuality: '15',
                    volumeLevel: '10',
                    rewardRisk: '3',
                    accountSize: '25000',
                    riskPercent: '1.5',
                    tradesPerMonth: '6'
                });
            }
            
            setAggressive() {
                this.setValues({
                    trendDirection: '50',
                    emaAlignment: '40',
                    entryQuality: '25',
                    volumeLevel: '15',
                    rewardRisk: '4',
                    accountSize: '50000',
                    riskPercent: '2.5',
                    tradesPerMonth: '10'
                });
            }
            
            reset() {
                this.setValues({
                    trendDirection: '0',
                    emaAlignment: '0',
                    entryQuality: '0',
                    volumeLevel: '0',
                    rewardRisk: '3',
                    accountSize: '',
                    riskPercent: '',
                    tradesPerMonth: ''
                });
            }
            
            setValues(values) {
                Object.keys(values).forEach(key => {
                    if (this.elements[key]) {
                        this.elements[key].value = values[key];
                    }
                });
                this.calculate();
            }
        }
        
        // Initialize calculator when DOM is ready
        const calculator = new TradingRiskCalculator();
        
        // Export for potential integration with other systems
        window.TradingRiskCalculator = TradingRiskCalculator;
        
        // LEX INTEGRATION SYSTEM - LACYCOM1 Strategic Implementation
        class LexIntegrationManager {
            constructor(calculator) {
                this.calculator = calculator;
                this.lexMemory = this.initializeLexMemory();
                this.assessmentHistory = [];
                this.integrationActive = true;
                
                // Hook into calculator events
                this.setupCalculatorIntegration();
                
                console.log('Lex Integration Manager initialized - Dashboard connected to agent memory');
            }
            
            initializeLexMemory() {
                // Initialize Lex memory structure for dashboard data
                return {
                    module_id: 'ema_dashboard',
                    domain: 'risk_assessment',
                    last_updated: new Date().toISOString(),
                    session_data: {
                        assessments_completed: 0,
                        average_success_rate: 0,
                        risk_tolerance_pattern: 'unknown',
                        preferred_setup_type: 'unknown',
                        learning_insights: []
                    },
                    cross_domain_insights: {
                        financial_planning: [],
                        clinical_assessment: [],
                        decision_making_patterns: []
                    },
                    agent_recommendations: []
                };
            }
            
            setupCalculatorIntegration() {
                // Override calculator's updateDisplay method to capture data
                const originalUpdateDisplay = this.calculator.updateDisplay.bind(this.calculator);
                
                this.calculator.updateDisplay = (values) => {
                    // Call original method
                    originalUpdateDisplay(values);
                    
                    // Capture data for Lex memory
                    this.captureAssessmentData(values);
                };
                
                // Override setValues methods to track user preferences
                const originalSetConservative = this.calculator.setConservative.bind(this.calculator);
                const originalSetAggressive = this.calculator.setAggressive.bind(this.calculator);
                
                this.calculator.setConservative = () => {
                    originalSetConservative();
                    this.trackUserPreference('conservative');
                };
                
                this.calculator.setAggressive = () => {
                    originalSetAggressive();
                    this.trackUserPreference('aggressive');
                };
            }
            
            captureAssessmentData(calculationResults) {
                if (!this.integrationActive) return;
                
                const timestamp = new Date().toISOString();
                const assessment = {
                    timestamp: timestamp,
                    results: calculationResults,
                    input_parameters: this.getCurrentInputs(),
                    user_context: this.analyzeUserContext()
                };
                
                // Add to history
                this.assessmentHistory.push(assessment);
                
                // Update Lex memory
                this.updateLexMemory(assessment);
                
                // Generate insights for agent
                this.generateAgentInsights(assessment);
                
                // Log for debugging
                console.log('Assessment captured for Lex integration:', assessment);
            }
            
            getCurrentInputs() {
                return {
                    trend_direction: this.calculator.getSelectValue('trendDirection', 0),
                    ema_alignment: this.calculator.getSelectValue('emaAlignment', 0),
                    entry_quality: this.calculator.getSelectValue('entryQuality', 0),
                    volume_level: this.calculator.getSelectValue('volumeLevel', 0),
                    reward_risk: this.calculator.getNumericValue('rewardRisk', 3),
                    account_size: this.calculator.getNumericValue('accountSize', 25000),
                    risk_percent: this.calculator.getNumericValue('riskPercent', 2),
                    trades_per_month: this.calculator.getNumericValue('tradesPerMonth', 8)
                };
            }
            
            analyzeUserContext() {
                const inputs = this.getCurrentInputs();
                const analysis = {
                    risk_tolerance: this.assessRiskTolerance(inputs),
                    experience_level: this.assessExperienceLevel(inputs),
                    decision_pattern: this.assessDecisionPattern(),
                    consistency_score: this.calculateConsistencyScore()
                };
                
                return analysis;
            }
            
            assessRiskTolerance(inputs) {
                const riskScore = (inputs.risk_percent * 10) + (inputs.reward_risk * 5);
                
                if (riskScore > 40) return 'high_risk';
                if (riskScore > 25) return 'moderate_risk';
                return 'conservative';
            }
            
            assessExperienceLevel(inputs) {
                const experienceIndicators = [
                    inputs.account_size > 50000 ? 1 : 0,
                    inputs.reward_risk > 3 ? 1 : 0,
                    inputs.trades_per_month > 10 ? 1 : 0,
                    inputs.risk_percent < 3 ? 1 : 0
                ];
                
                const score = experienceIndicators.reduce((a, b) => a + b, 0);
                
                if (score >= 3) return 'experienced';
                if (score >= 2) return 'intermediate';
                return 'beginner';
            }
            
            assessDecisionPattern() {
                if (this.assessmentHistory.length < 3) return 'insufficient_data';
                
                const recentAssessments = this.assessmentHistory.slice(-5);
                const patterns = {
                    conservative_bias: 0,
                    aggressive_bias: 0,
                    consistent_approach: 0
                };
                
                recentAssessments.forEach(assessment => {
                    const inputs = assessment.input_parameters;
                    if (inputs.risk_percent < 2) patterns.conservative_bias++;
                    if (inputs.risk_percent > 3) patterns.aggressive_bias++;
                });
                
                const dominant = Object.keys(patterns).reduce((a, b) => 
                    patterns[a] > patterns[b] ? a : b
                );
                
                return dominant;
            }
            
            calculateConsistencyScore() {
                if (this.assessmentHistory.length < 3) return 0;
                
                const recent = this.assessmentHistory.slice(-3);
                let consistency = 0;
                
                // Check for consistent risk percentages
                const riskPercentages = recent.map(a => a.input_parameters.risk_percent);
                const riskStdDev = this.calculateStandardDeviation(riskPercentages);
                if (riskStdDev < 0.5) consistency += 25;
                
                // Check for consistent reward:risk ratios
                const rewardRatios = recent.map(a => a.input_parameters.reward_risk);
                const ratioStdDev = this.calculateStandardDeviation(rewardRatios);
                if (ratioStdDev < 0.5) consistency += 25;
                
                // Check for consistent assessment quality
                const avgScores = recent.map(a => {
                    const total = a.input_parameters.trend_direction + 
                                 a.input_parameters.ema_alignment + 
                                 a.input_parameters.entry_quality + 
                                 a.input_parameters.volume_level;
                    return total;
                });
                const scoreStdDev = this.calculateStandardDeviation(avgScores);
                if (scoreStdDev < 10) consistency += 50;
                
                return Math.min(100, consistency);
            }
            
            calculateStandardDeviation(values) {
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                const squareDiffs = values.map(value => Math.pow(value - avg, 2));
                const avgSquareDiff = squareDiffs.reduce((a, b) => a + b, 0) / squareDiffs.length;
                return Math.sqrt(avgSquareDiff);
            }
            
            updateLexMemory(assessment) {
                // Update session statistics
                this.lexMemory.session_data.assessments_completed++;
                this.lexMemory.last_updated = assessment.timestamp;
                
                // Calculate rolling averages
                if (assessment.results.successRate) {
                    const currentAvg = this.lexMemory.session_data.average_success_rate;
                    const count = this.lexMemory.session_data.assessments_completed;
                    const successRate = parseFloat(assessment.results.successRate.replace('%', ''));
                    
                    this.lexMemory.session_data.average_success_rate = 
                        ((currentAvg * (count - 1)) + successRate) / count;
                }
                
                // Update risk tolerance pattern
                this.lexMemory.session_data.risk_tolerance_pattern = assessment.user_context.risk_tolerance;
                
                // Add learning insights
                const insight = this.generateLearningInsight(assessment);
                if (insight) {
                    this.lexMemory.session_data.learning_insights.push({
                        timestamp: assessment.timestamp,
                        insight: insight,
                        confidence: this.calculateInsightConfidence(assessment)
                    });
                    
                    // Keep only last 10 insights
                    if (this.lexMemory.session_data.learning_insights.length > 10) {
                        this.lexMemory.session_data.learning_insights.shift();
                    }
                }
            }
            
            generateLearningInsight(assessment) {
                const context = assessment.user_context;
                const inputs = assessment.input_parameters;
                const results = assessment.results;
                
                // Generate contextual insights
                if (context.risk_tolerance === 'high_risk' && parseFloat(results.successRate?.replace('%', '') || '0') < 50) {
                    return 'User tends toward high-risk setups but may benefit from more conservative approach';
                }
                
                if (context.consistency_score > 80) {
                    return 'User demonstrates excellent consistency in risk management approach';
                }
                
                if (inputs.reward_risk > 4 && context.experience_level === 'beginner') {
                    return 'Beginner using aggressive reward:risk ratios - may need education on realistic expectations';
                }
                
                if (this.assessmentHistory.length > 5) {
                    const successRates = this.assessmentHistory.slice(-5).map(a => 
                        parseFloat(a.results.successRate?.replace('%', '') || '0')
                    );
                    const avgSuccess = successRates.reduce((a, b) => a + b, 0) / successRates.length;
                    
                    if (avgSuccess > 70) {
                        return 'User consistently identifies high-probability setups - advanced pattern recognition';
                    }
                }
                
                return null;
            }
            
            calculateInsightConfidence(assessment) {
                let confidence = 50; // Base confidence
                
                // Increase confidence based on data quality
                if (this.assessmentHistory.length > 10) confidence += 20;
                if (assessment.user_context.consistency_score > 70) confidence += 15;
                if (assessment.input_parameters.account_size > 25000) confidence += 10;
                
                return Math.min(95, confidence);
            }
            
            generateAgentInsights(assessment) {
                const recommendations = [];
                
                // Risk management recommendations
                if (assessment.input_parameters.risk_percent > 5) {
                    recommendations.push({
                        type: 'risk_management',
                        priority: 'high',
                        message: 'Consider reducing risk percentage - current level may lead to significant drawdowns',
                        action: 'suggest_max_risk_3_percent'
                    });
                }
                
                // Setup quality recommendations
                const totalScore = assessment.input_parameters.trend_direction + 
                                 assessment.input_parameters.ema_alignment + 
                                 assessment.input_parameters.entry_quality + 
                                 assessment.input_parameters.volume_level;
                
                if (totalScore < 50) {
                    recommendations.push({
                        type: 'setup_quality',
                        priority: 'medium',
                        message: 'Low-probability setup detected - consider waiting for better conditions',
                        action: 'suggest_patience'
                    });
                }
                
                // Experience-based recommendations
                if (assessment.user_context.experience_level === 'beginner' && 
                    assessment.input_parameters.trades_per_month > 15) {
                    recommendations.push({
                        type: 'education',
                        priority: 'medium',
                        message: 'High trade frequency for beginner - focus on quality over quantity',
                        action: 'suggest_education_resources'
                    });
                }
                
                // Cross-domain insights
                this.generateCrossDomainInsights(assessment, recommendations);
                
                // Store recommendations in Lex memory
                this.lexMemory.agent_recommendations = recommendations;
            }
            
            generateCrossDomainInsights(assessment, recommendations) {
                const context = assessment.user_context;
                
                // Financial planning insights
                if (assessment.input_parameters.account_size < 25000 && 
                    assessment.input_parameters.risk_percent > 3) {
                    this.lexMemory.cross_domain_insights.financial_planning.push({
                        timestamp: assessment.timestamp,
                        insight: 'Small account with high risk percentage suggests need for capital preservation strategy',
                        relevance: ['emergency_fund', 'debt_reduction', 'income_stability']
                    });
                }
                
                // Clinical assessment insights (decision-making patterns)
                if (context.decision_pattern === 'aggressive_bias') {
                    this.lexMemory.cross_domain_insights.clinical_assessment.push({
                        timestamp: assessment.timestamp,
                        insight: 'User shows pattern of aggressive decision-making - may benefit from impulse control strategies',
                        relevance: ['risk_assessment', 'cognitive_bias', 'behavioral_patterns']
                    });
                }
                
                // Decision-making pattern insights
                if (context.consistency_score < 30) {
                    this.lexMemory.cross_domain_insights.decision_making_patterns.push({
                        timestamp: assessment.timestamp,
                        insight: 'Inconsistent decision-making patterns detected - suggests need for systematic approach',
                        relevance: ['decision_frameworks', 'systematic_thinking', 'consistency_training']
                    });
                }
            }
            
            // Public methods for Lex agent integration
            getLexMemorySnapshot() {
                return JSON.parse(JSON.stringify(this.lexMemory));
            }
            
            getAgentRecommendations() {
                return this.lexMemory.agent_recommendations;
            }
            
            getCrossDomainInsights() {
                return this.lexMemory.cross_domain_insights;
            }
            
            getSessionSummary() {
                return {
                    total_assessments: this.lexMemory.session_data.assessments_completed,
                    average_success_rate: this.lexMemory.session_data.average_success_rate.toFixed(1),
                    risk_profile: this.lexMemory.session_data.risk_tolerance_pattern,
                    learning_insights: this.lexMemory.session_data.learning_insights.length,
                    agent_recommendations: this.lexMemory.agent_recommendations.length,
                    cross_domain_opportunities: Object.keys(this.lexMemory.cross_domain_insights).length
                };
            }
            
            exportForLexSync() {
                // Format data for Lex memory system integration
                return {
                    module: 'ema_dashboard',
                    type: 'assessment_data',
                    timestamp: new Date().toISOString(),
                    data: this.getLexMemorySnapshot(),
                    integration_points: {
                        financial_planning: this.lexMemory.cross_domain_insights.financial_planning.length > 0,
                        clinical_assessment: this.lexMemory.cross_domain_insights.clinical_assessment.length > 0,
                        decision_making: this.lexMemory.cross_domain_insights.decision_making_patterns.length > 0
                    },
                    ready_for_sync: true
                };
            }
        }
        
        // Initialize Lex Integration
        const lexIntegration = new LexIntegrationManager(calculator);
        
        // Export for Lex agent access
        window.LexDashboardIntegration = lexIntegration;
        
        // Add UI indicator for Lex integration status
        const integrationStatus = document.createElement('div');
        integrationStatus.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 8px;
            padding: 10px;
            color: #00ff88;
            font-size: 0.9em;
            z-index: 1000;
        `;
        integrationStatus.innerHTML = 'ü§ñ Lex Integration Active';
        document.body.appendChild(integrationStatus);
        
        // Console log for integration confirmation
        console.log('üéØ LACYCOM1 LEX INTEGRATION COMPLETE');
        console.log('Dashboard now feeds data to Lex agent memory system');
        console.log('Cross-domain insights available for:', Object.keys(lexIntegration.getCrossDomainInsights()));
        console.log('Access integration data via: window.LexDashboardIntegration');
    </script>
</body>
</html>
            